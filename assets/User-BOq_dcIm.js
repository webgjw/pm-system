import{H as b,o as h,c as k,d as C,e as o,w as s,E as Z,g as ee,f as e,h as le,i as c,t as f,j as oe,I as te,K as ae,s as re,F as R,v as ne,q as se,x as de,S as ie,D as me,L as ue,r as S,m as U,k as q,T as pe}from"./index-DHRVARTs.js";/* empty css                  *//* empty css                  *//* empty css                 *//* empty css                     */import{a as ce}from"./app-role-0jWNqlGq.js";import{u as fe}from"./use-table-handlers-Dxt4lftd.js";const be=d=>b({url:"app/user/listPage",method:"get",data:d}),ge=d=>b({url:"app/user/save",method:"post",data:d}),_e=d=>{const{id:m}=d;return delete d.id,b({url:`app/user/update/${m}`,method:"post",data:d})},he=d=>{const{id:m}=d;return delete d.id,b({url:`app/user/delete/${m}`,method:"post",data:d})},Ve={class:"main-body"},ve={class:"toolbar"},Se={__name:"User",setup(d){const m=S({name:""}),t=S({id:"",name:"",deptId:"",email:"",mobile:"",roleIds:[],status:!0}),{t:l,tableRef:x,dialogVisible:g,isEdit:_,formLoading:D,formRef:V,doSearch:T,doAdd:$,doEdit:B,doSubmit:O,doClose:v,doRemove:W}=fe(t),H=q([]),I=q([]),F=U(()=>[{type:"selection"},{prop:"id",label:l("thead.ID"),minWidth:50},{prop:"name",label:l("thead.username"),minWidth:120},{prop:"deptName",label:l("thead.dept"),minWidth:120,showOverflowTooltip:!0},{prop:"roleNames",label:l("thead.role"),minWidth:100,showOverflowTooltip:!0},{prop:"email",label:l("thead.email"),minWidth:120,showOverflowTooltip:!0},{prop:"mobile",label:l("thead.mobile"),minWidth:100},{prop:"status",label:l("thead.status"),minWidth:70,formatter:a=>a.status?l("status.on"):l("status.off")}]),E=(a,r,u)=>{!t.email&&!t.mobile&&u(new Error(l("form.emailOrMobile"))),(!t.mobile||!t.email)&&V.value.clearValidate(a.field==="email"?"mobile":"email"),u()},N=U(()=>({name:[{required:!0,message:l("form.usernameHolder"),trigger:["change","blur"]}],deptId:[{required:!0,message:l("form.deptRequired"),trigger:["change","blur"]}],email:[{type:"email",message:l("form.emailError"),trigger:["change","blur"]},{validator:E,message:l("form.emailOrMobile"),trigger:["change","blur"]}],mobile:[{pattern:/^1[3-9]\d{9}$/,message:l("form.usernameHolder"),trigger:["change","blur"]},{validator:E,message:l("form.emailOrMobile"),trigger:["change","blur"]}],roleIds:[{required:!0,message:l("form.roleIdsRequired"),trigger:["change","blur"]}]}));function w(){L(),findRoles()}function M(a){w(),$(a)}function P(a){w(),B(a),t.roleIds=a.roleIds.split(",").map(r=>+r),t.status=!!a.status}function L(){ce().then(a=>{I.value=a.data})}function j(a,r){W(he,a,r)}function A(){O({save:ge,update:_e,getParams:K},a=>{_.value||pe.alert(`${l("tips.success")}${l("form.username")}:${a.data.name},${l("form.password")}:${a.data.password}`,l("tips.title"),{confirmButtonText:l("action.confirm")})})}function K(){const a={...t};return _.value||delete a.id,a.roleIds=t.roleIds.join(","),a}return(a,r)=>{const u=ee,i=Z,p=le,y=oe,z=te,G=ae,J=de,Q=re,X=ie,Y=ue;return h(),k(R,null,[C("div",Ve,[C("div",ve,[o(y,{inline:!0,model:e(m)},{default:s(()=>[o(i,null,{default:s(()=>[o(u,{modelValue:e(m).name,"onUpdate:modelValue":r[0]||(r[0]=n=>e(m).name=n),placeholder:e(l)("thead.username")},null,8,["modelValue","placeholder"])]),_:1}),o(i,null,{default:s(()=>[o(p,{icon:"search",type:"primary",onClick:e(T)},{default:s(()=>[c(f(e(l)("action.search")),1)]),_:1},8,["onClick"])]),_:1}),o(i,null,{default:s(()=>[o(p,{icon:"plus",type:"primary",onClick:M},{default:s(()=>[c(f(e(l)("action.add")),1)]),_:1})]),_:1})]),_:1},8,["model"])]),o(z,{ref_key:"tableRef",ref:x,"get-page":e(be),filters:e(m),columns:e(F),onHandleEdit:P,onHandleDelete:j},null,8,["get-page","filters","columns"])]),o(Y,{title:e(_)?e(l)("action.edit"):e(l)("action.add"),modelValue:e(g),"onUpdate:modelValue":r[7]||(r[7]=n=>me(g)?g.value=n:null),draggable:"",width:"50%","close-on-click-modal":!1,onClose:e(v)},{footer:s(()=>[o(p,{onClick:e(v)},{default:s(()=>[c(f(e(l)("action.cancel")),1)]),_:1},8,["onClick"]),o(p,{type:"primary",onClick:A,loading:e(D)},{default:s(()=>[c(f(e(l)("action.submit")),1)]),_:1},8,["loading"])]),default:s(()=>[o(y,{ref_key:"formRef",ref:V,model:e(t),"label-width":"80px",rules:e(N),"label-position":"right"},{default:s(()=>[o(i,{label:e(l)("form.username"),prop:"name"},{default:s(()=>[o(u,{modelValue:e(t).name,"onUpdate:modelValue":r[1]||(r[1]=n=>e(t).name=n)},null,8,["modelValue"])]),_:1},8,["label"]),o(i,{label:e(l)("form.dept"),prop:"deptId"},{default:s(()=>[o(G,{modelValue:e(t).deptId,"onUpdate:modelValue":r[2]||(r[2]=n=>e(t).deptId=n),props:{label:"name",value:"id",checkStrictly:!0,emitPath:!1},options:e(H),clearable:"",filterable:"",class:"w100p"},null,8,["modelValue","options"])]),_:1},8,["label"]),o(i,{label:e(l)("form.email"),prop:"email"},{default:s(()=>[o(u,{modelValue:e(t).email,"onUpdate:modelValue":r[3]||(r[3]=n=>e(t).email=n)},null,8,["modelValue"])]),_:1},8,["label"]),o(i,{label:e(l)("form.mobile"),prop:"mobile"},{default:s(()=>[o(u,{modelValue:e(t).mobile,"onUpdate:modelValue":r[4]||(r[4]=n=>e(t).mobile=n)},null,8,["modelValue"])]),_:1},8,["label"]),o(i,{label:e(l)("form.role"),prop:"roleIds"},{default:s(()=>[o(Q,{modelValue:e(t).roleIds,"onUpdate:modelValue":r[5]||(r[5]=n=>e(t).roleIds=n),multiple:"",placeholder:e(l)("form.choose"),style:{width:"100%"}},{default:s(()=>[(h(!0),k(R,null,ne(e(I),n=>(h(),se(J,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),o(i,{label:e(l)("status.on")},{default:s(()=>[o(X,{modelValue:e(t).status,"onUpdate:modelValue":r[6]||(r[6]=n=>e(t).status=n)},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onClose"])],64)}}};export{Se as default};
